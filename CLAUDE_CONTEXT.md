# NGR MVP — Claude Code Context

## What This Codebase Is

This directory contains the MVP artifacts for the **Next Generation Patient Registry (NGR)** for the **Cystic Fibrosis Foundation (CFF)**. These artifacts were generated by an **AWS Bedrock AgentCore multi-agent pipeline** — a production system built for Slalom that demonstrates AI-driven SDLC acceleration by converting an RFP into working software artifacts.

The artifacts are **not hand-written code** — they are the output of a 5-stage AI pipeline:

```
RFP PDF → [BA Agent] → [Architect Agent] → [Engineer Agent] → [QA Agent] → [DevOps Agent]
                                                                                    ↓
                                              102 artifacts across PRD, architecture, source code, tests, IaC
```

All artifacts live under `s3://cff-ngr-mvp/` (run ID: `271c9944-1e04-4d3d-91b9-9c0d9b99a354`).

---

## The Client & Project

**Client:** Cystic Fibrosis Foundation (CFF)
**Project:** NGR — Next Generation Patient Registry
**Engagement type:** RFP response / competitive bid (Firm-Fixed Price)
**Contract start:** Q2 2026
**Target launch:** Q1 2028
**Slalom role:** Full platform delivery partner

### The Problem Being Solved

CFF has operated a patient registry (PortCF) since the 1960s tracking ~50,000 CF patients — approximately 80% of all CF patients in the United States. PortCF is:
- Facing security vulnerabilities and technology deprecation
- Inflexible for modern care workflows (CFTR modulators have reduced in-person visits significantly)
- Unable to support future EMR integration, patient portals, or wearable data collection

NGR is a full re-platforming of PortCF, focused on feature parity MVP while architecting for future extensibility.

---

## Key Win Themes (Why CFF Should Choose Slalom)

These themes should inform any enhancements, presentations, or documentation:

1. **Zero disruption migration** — 100% data fidelity (DWID match), parallel operation support during cutover, no data loss from 60+ years of registry data
2. **Security-first** — HIPAA PHI compliance, SOC 2 Type 2 / HITRUST / ISO 27001 certification path, environment isolation, pen testing before launch
3. **Extensibility by design** — Architecture explicitly enables future EMR integration, patient portal, HIE/QHIN, wearables — without major refactoring
4. **Proven delivery model** — Agile (≤2-week sprints), Azure DevOps for work tracking, Microsoft Teams for collaboration (CFF's existing tooling)
5. **Scale at confidence** — Built for 3,000+ concurrent clinical users across 136 care centers, ~1TB data, ~4M encounters

---

## Tech Stack (MANDATORY — dictated by CFF RFP + tech-stack.pdf)

| Layer | Technology | Notes |
|-------|-----------|-------|
| Frontend | React 18 TypeScript | SPA |
| API | ASP.NET Core 8 Web API (C# 12) | REST, not GraphQL |
| Database | Azure SQL Database | EF Core 8 migrations |
| Auth | Okta (OIDC/SAML) | CFF has existing Okta instance |
| Hosting | Azure App Services | Not AKS/Kubernetes |
| CI/CD | Azure DevOps YAML Pipelines | Not GitHub Actions |
| Testing E2E | Playwright (TypeScript) | |
| Testing unit | xUnit (.NET) | |
| Code quality | SonarQube + OWASP ZAP | |
| Monitoring | Azure Application Insights + Azure WAF | |
| IaC | Terraform (hashicorp/azurerm) | |

**Do not deviate from this stack.** Tech choices were specified by CFF in their RFP appendices.

---

## Artifact Structure

```
patient-registry-mvp/
│
├── prd/271c9944-*/               # Business Analysis stage outputs
│   ├── prd.md                    # Full Product Requirements Document
│   ├── user_stories.md           # Epics and user stories with acceptance criteria
│   ├── acceptance_criteria.md    # Detailed acceptance criteria per feature
│   ├── ambiguities.md            # Open questions / assumptions made
│   └── prd_summary_for_architect.md  # Technical handoff summary
│
├── architecture/271c9944-*/      # Architecture stage outputs
│   ├── system_design.md          # Full system design with C4 diagrams
│   ├── api_specs/api.yaml        # OpenAPI 3.0 spec for NGR API
│   ├── adrs/                     # Architecture Decision Records (ADRs)
│   └── components.json           # Component manifest used by downstream agents
│
├── src/271c9944-*/               # Engineer stage outputs (~61 files)
│   ├── ngr-api/                  # ASP.NET Core 8 REST API (C# 12)
│   │   ├── Controllers/          # API controllers (PatientRegistry, Forms, Reports, etc.)
│   │   ├── Entities/             # EF Core domain entities (23 files)
│   │   ├── Data/                 # ApplicationDbContext, migrations
│   │   ├── Services/             # Business logic services
│   │   ├── DTOs/                 # Data transfer objects
│   │   ├── Validators/           # FluentValidation rules
│   │   ├── Middleware/           # Auth, error handling middleware
│   │   └── Program.cs            # App bootstrapping, DI registration
│   ├── ngr-web-app/              # React 18 TypeScript SPA
│   │   └── src/                  # Components, hooks, services
│   └── ngr-database/             # EF Core database project
│       └── Migrations/           # Azure SQL schema migrations
│
├── tests/271c9944-*/             # QA stage outputs
│   └── api/UnitTests/            # xUnit unit tests for API controllers
│
├── iac/271c9944-*/               # DevOps stage outputs (~32 files)
│   ├── terraform/                # 27 Terraform modules for Azure infra
│   │   ├── main.tf               # Root module, provider config
│   │   ├── networking.tf         # VNet, subnets, NSGs, WAF
│   │   ├── app-services.tf       # Azure App Services plan + apps
│   │   ├── database.tf           # Azure SQL Server + databases
│   │   ├── key-vault.tf          # Secrets management
│   │   ├── monitoring.tf         # App Insights, Log Analytics
│   │   └── ...                   # Additional modules (storage, identity, etc.)
│   ├── cicd/azure-pipelines.yml  # Full CI/CD pipeline (322 lines)
│   │   # Stages: Build → Test → SonarQube → OWASP ZAP → Deploy Dev
│   │   #         → Playwright E2E → Deploy Prod (manual gate)
│   ├── dockerfiles/
│   │   ├── api.Dockerfile        # Multi-stage .NET 8 build, non-root user
│   │   ├── web-app.Dockerfile    # Node 20 build → nginx:1.27-alpine
│   │   └── docker-compose.yml    # Local dev: SQL Server + API + React
│   └── runbook.md                # Ops runbook: deploy, rollback, scaling, incident response
│
└── reports/271c9944-*/
    └── delivery_report.json      # Pipeline completion manifest
```

---

## Functional Requirements Summary

### Must-Have Features (MVP)

| Feature | Description |
|---------|-------------|
| **SSO / Auth** | Okta OIDC/SAML integration, RBAC with multiple configurable roles |
| **Patient Roster** | Add / transfer / merge / remove patients; master patient index; DWID preservation |
| **eCRF Form Engine** | Dynamic form rendering from machine-readable specs; field validation; conditional logic; derived fields; auto-save; form versioning |
| **Business Rules Engine** | Ownership rules (by care program); sharing rules (between programs); edit permissions (role + timing) |
| **CSV Upload** | Pre-fill eCRFs from EMR CSV exports; validation against form specs |
| **Data Warehouse Feed** | Nightly batch export to CFF data warehouse; must complete in <3 hours |
| **Report Builder** | Dynamic patient list queries with custom criteria; standard pre-built reports; program vs. cross-program access |
| **Content Management** | Foundation self-service publishing of docs + announcements; no dev intervention required |
| **Data Migration** | 100% PortCF data migrated; 100% DWID match; 100% variable accuracy; zero data loss |

### Non-Functional Requirements

| Category | Requirement |
|----------|------------|
| **Users** | 3,000+ concurrent across 136 care centers |
| **Data scale** | ~35,000 active patients, ~4M encounters, ~1TB, +1,000 patients/year |
| **Performance** | Form load times per Appendix A spec; nightly batch <3 hours |
| **Security** | HIPAA PHI; SOC 2 Type 2 / HITRUST / ISO 27001; env isolation; pen testing |
| **Availability** | Load-balanced, fault-tolerant; no downtime during migration |
| **Test coverage** | Minimum 70% unit test coverage |
| **Compliance** | Appendix E security/privacy requirements |

---

## Architecture Decisions (from ADRs)

- **Cloud:** Azure (Microsoft ecosystem alignment with CFF)
- **Hosting:** Azure App Services (not AKS — lower ops overhead for MVP)
- **Auth:** Okta (CFF has existing instance; OIDC + SAML for SSO)
- **Database:** Azure SQL (relational model fits patient/encounter/form structure; HIPAA-ready)
- **API style:** RESTful (not GraphQL) — simpler for MVP, extensible later
- **Frontend:** React 18 TypeScript SPA communicating via REST to API tier
- **Form engine:** Custom implementation driven by machine-readable JSON/XML specs (Appendix C format)
- **Migration strategy:** Parallel operation (PortCF + NGR simultaneously during cutover window)

---

## What Is NOT In Scope for MVP

Do not add these features without explicit direction:
- Real-time EMR integration (CSV upload is the MVP bridge)
- Patient portal (future phase)
- HIE/QHIN integration
- Wearable data collection
- Real-time reporting
- Data warehouse re-platforming
- CFSmartReports replacement
- Care program user training (CFF handles separately)

The architecture **must** be extensible to support all of the above in future phases.

---

## Key Risks to Keep in Mind

1. **Data migration complexity** — 60+ years of data; any approach needs early POC and parallel operation strategy
2. **Form engine complexity** — Machine-readable specs (Appendix C) drive dynamic form rendering; this is the most complex custom component
3. **Data warehouse integration** — Existing CFF warehouse must accept nightly feed; early integration testing required
4. **Security certification** — SOC 2 / HITRUST path needs early auditor engagement (not a sprint 20 task)
5. **Parallel operation integrity** — Clear data governance needed when both PortCF and NGR are live simultaneously

---

## How These Artifacts Were Generated

This MVP was produced by an **AI-driven SDLC pipeline** built on **AWS Bedrock AgentCore**, developed by Slalom to demonstrate accelerated proposal-to-prototype delivery:

### Pipeline Architecture
- **Orchestrator:** Python agent on AgentCore that drives the 5-stage pipeline via agent-to-agent (A2A) invocation
- **5 Persona Agents** (each a Strands-based Claude Opus 4.5 agent):
  1. **BA Agent** — reads RFP PDF, produces PRD + user stories + acceptance criteria + ambiguities
  2. **Architect Agent** — reads PRD, produces system design + API spec + ADRs + components manifest
  3. **Engineer Agent** — reads architecture artifacts, produces all source code
  4. **QA Agent** — reads source code + requirements, produces xUnit test suite
  5. **DevOps Agent** — reads all prior artifacts, produces Terraform IaC + CI/CD pipeline + Dockerfiles + runbook
- **MCP Gateway:** AWS Bedrock AgentCore Gateway backed by Lambda tools (`parse_rfp`, `write_artifact`, `read_artifact`, `list_artifacts`, etc.)
- **State:** Stored in S3 (`s3://cff-ngr-mvp/pipeline-state/{run_id}/state.json`) — resumable if any stage fails
- **Memory:** AgentCore episodic+semantic memory for cross-agent context sharing

### Pipeline Run Details
- **Run ID:** `271c9944-1e04-4d3d-91b9-9c0d9b99a354`
- **Completed:** Feb 24, 2026
- **Total artifacts:** 102 files
- **Source:** `s3://cff-ngr-mvp/`

### Known Limitations of Generated Code
Because this code was AI-generated as an MVP demonstration:
- **Test coverage is thin** — QA agent wrote 1 xUnit test file; production code will need comprehensive test suites
- **Business rules are approximated** — The form engine, ownership/sharing rules, and RBAC are structurally correct but will need refinement against Appendix A/C/E (not provided in RFP)
- **Data migration is not implemented** — The IaC and API provide the data model; the actual PortCF migration ETL is out of scope for this MVP
- **Form specs are stubbed** — Real eCRF machine-readable specs (Appendix C format) from CFF are required before form engine can be fully wired
- **Secrets are placeholder** — All connection strings, Okta config, etc. use placeholder values; wire to Azure Key Vault for real deployment

---

## Immediate Next Steps for Development

1. **Review PRD** (`prd/`) — validate requirements coverage against actual Appendix A/C/E from CFF
2. **Stand up local dev** — use `iac/dockerfiles/docker-compose.yml` to run SQL Server + API + React locally
3. **Run migrations** — `dotnet ef database update` in `ngr-database/` to create schema
4. **Wire Okta** — configure OIDC settings in `ngr-api/Program.cs` with real CFF Okta tenant
5. **Expand tests** — QA agent produced a skeleton; extend to 70%+ coverage per NFR
6. **Validate form engine** — when CFF provides Appendix C machine-readable specs, validate against form engine implementation
7. **Terraform plan** — `terraform plan` in `iac/terraform/` to validate Azure infra before provisioning

---

## Contacts & Context

- **Slalom engagement:** RFP-to-MVP pipeline demo for CFF
- **AWS account:** `381492275184` (slalom-demos profile)
- **S3 artifacts bucket:** `s3://cff-ngr-mvp`
- **AgentCore pipeline source:** `/Users/james.sturges/code/_clients/cff/rfp-to-mvp/` (separate repo)
